(function(c){function l(a,d){var b=1,f,c;c=a.length;f=0;for(c;f<c;f++)b*=a.charCodeAt(f)*n,b-=Math.floor(b);return d[Math.floor(b*d.length)]}function p(a,d){var b=null;this.element=a;this.$el=c(a);this.opts=c.extend({},q,d);this.gmap=null;this._marcadores={};this.init=function(){this.opts.center=new google.maps.LatLng(this.opts.center.lat,this.opts.center.lng);this.opts.streetViewControl=!1;this.opts.scaleControl=!0;this.opts.mapTypeControlOptions={style:google.maps.MapTypeControlStyle.DROPDOWN_MENU};
var a=e._prepararContenedor(this.$el);this.gmap=b=new google.maps.Map(a,this.opts);this.$el.data("gmap",b);google.maps.event.addListener(b,"maptypeid_changed",function(){b.setZoom(b.getZoom()+1);b.setZoom(b.getZoom()-1)});e.GmapAgregarCapaBase(b,new e.CapaBaseArgenmap);e.GmapAgregarCapa(b,new e.CapaTMSArgenmap);this.gmap.setMapTypeId("Mapa IGN");return!0};this.agregarCapaKML=function(a){var b={preserveViewport:!0,map:this.$el.data("gmap")};a=c.extend(b,a);new google.maps.KmlLayer(a)};this.infoWindow=
function(){void 0===this._infoWindow&&(this._infoWindow=new google.maps.InfoWindow);return this._infoWindow};this.agregarMarcador=function(a){var b=this,d={icon:e.BASEURL+"img/marcadores/punto.png",title:"Marcador",nombre:"Marcador_"+Math.floor(10100*Math.random())};a.icon=a.icono||void 0;a.data=a.contenido;a.position=new google.maps.LatLng(a.lat,a.lng);a.title=a.nombre;a=c.extend(d,a);a.map=b.$el.data("gmap");var k=new google.maps.Marker(a);this._marcadores[a.nombre]=k;google.maps.event.addListener(k,
"click",function(){a.contenido&&(b.infoWindow().open(b.$el.data("gmap"),k),b.infoWindow().setContent(a.contenido))})};this.quitarMarcador=function(a){void 0!==this._marcadores[a]&&(this._marcadores[a].setMap(null),delete this._marcadores[a])};this.modificarMarcador=function(a,b){if(void 0!==this._marcadores[a]){var d=this._marcadores[a];this.quitarMarcador(a);b=c.extend(d,b);b.nombre=a;this.agregarMarcador(b)}};this.geocodificar=function(a,b){c.getJSON("http://nominatim.openstreetmap.org/search?format=json&limit=5&q="+
a,function(a){a.length&&b(a);console.log(a)},this)};this.encuadrarResultadoDeGeocodificacion=function(a){var b=a.boundingbox[2],d=a.boundingbox[1];a=new L.LatLng(a.boundingbox[0],b);b=new L.LatLng(d,b);b=new L.LatLngBounds(a,b);this.Lmap.fitBounds(b)}}var m=["http://cg.aws.af.cm/tms","http://robomap-cgastrell.rhcloud.com/tms","http://sig.ign.gob.ar/tms","http://190.220.8.216/tms","http://mapaabierto.aws.af.cm/tms"],e={BASEURL:"http://www.ign.gob.ar/argenmap/argenmap.jquery/"},n=(Math.sqrt(5)-1)/2,
q={unit:"km",zoom:5,mapTypeControl:!0,center:{lat:-34,lng:-59}};e.cacheDeCliente=function(){this.MAX_TILES=150;this.cache=[];this.cacheRef={}};e.cacheDeCliente.prototype={recuperar:function(a,d,b){a=a+"-"+d+"-"+b;return-1!==this.cache.indexOf(a)?this.cacheRef[a]:!1},guardar:function(a,d,b,f){"string"!==typeof this.baseURL&&(a=a+"-"+d+"-"+b,this.cache.push(a),this.cacheRef[a]=f,this.cache.length>this.MAX_TILES&&(f=this.cache.shift(),delete this.cacheRef[f]))}};e.CapaBaseWMS=function(a){this.gmap=this.imageMapType=
null;this.name="Capa base WMS";this.tipo="wms-1.1.1";jQuery.extend(this,a);a={alt:this.name,getTileUrl:jQuery.proxy(this.getTileUrl,this),isPng:!0,maxZoom:17,minZoom:3,name:this.name,tileSize:new google.maps.Size(256,256)};this.imageMapType=new google.maps.ImageMapType(a)};e.CapaBaseWMS.prototype.getTileUrl=function(a,d){var b=this.gmap.getProjection(),f=Math.pow(2,d),c=new google.maps.Point(256*a.x/f,256*(a.y+1)/f),f=new google.maps.Point(256*(a.x+1)/f,256*a.y/f),c=b.fromPointToLatLng(c),b=b.fromPointToLatLng(f),
f=this.baseURL,h=this.layers,c=e.latLngAMercator(c.lat(),c.lng()),b=e.latLngAMercator(b.lat(),b.lng());return f+"LAYERS="+h+"&TRANSPARENT=FALSE&VERSION=1.1.1&SERVICE=WMS&REQUEST=GetMap&STYLES=&FORMAT=image%2Fpng&SRS=EPSG:3857&BBOX="+(c.lng+","+c.lat+","+b.lng+","+b.lat)+"&WIDTH=256&HEIGHT=256"};e.CapaBaseTMS=function(a){this.cache=new e.cacheDeCliente;this.gmap=this.imageMapType=null;this.name="Capa base TMS";this.tipo="tms-1.0.0";jQuery.extend(this,a);a={alt:this.name,getTileUrl:jQuery.proxy(this.getTileUrl,
this),isPng:!0,maxZoom:17,minZoom:3,name:this.name,tileSize:new google.maps.Size(256,256)};this.imageMapType=new google.maps.ImageMapType(a)};e.CapaBaseTMS.prototype.getTileUrl=function(a,d){var b=this.baseURL;if("string"!==typeof b){var b=l(a.x+""+a.y,b),c=this.cache.recuperar(a.x,a.y,d);if(c)return c}b=b+"/"+this.layers+"/"+d+"/"+a.x+"/"+((1<<d)-a.y-1)+".png";this.cache.guardar(a.x,a.y,d,b);return b};e.CapaWMS=function(a){this.gmap=this.imageMapType=null;this.tipo="wms-1.1.1";this.alt=this.name=
"CAPA WMS";jQuery.extend(this,a);a={alt:this.alt,getTileUrl:jQuery.proxy(this.getTileUrl,this),isPng:!1,maxZoom:17,minZoom:6,name:this.name,tileSize:new google.maps.Size(256,256)};this.imageMapType=new google.maps.ImageMapType(a)};e.CapaWMS.prototype.getTileUrl=function(a,d){var b=this.gmap.getProjection(),c=Math.pow(2,d),g=new google.maps.Point(256*a.x/c,256*(a.y+1)/c),c=new google.maps.Point(256*(a.x+1)/c,256*a.y/c),g=b.fromPointToLatLng(g),b=b.fromPointToLatLng(c),c=this.baseURL,h=this.layers,
g=e.latLngAMercator(g.lat(),g.lng()),b=e.latLngAMercator(b.lat(),b.lng());return c+"VERSION=1.1.1&REQUEST=GetMap&LAYERS="+h+"&STYLES=&SRS=EPSG:3857&BBOX="+(g.lng+","+g.lat+","+b.lng+","+b.lat)+"&WIDTH=256&HEIGHT=256&FORMAT=image/png&TRANSPARENT=TRUE"};e.CapaTMS=function(a){this.cache=new e.cacheDeCliente;this.gmap=this.imageMapType=null;this.tipo="tms-1.0.0";this.alt=this.name="CAPA TMS";jQuery.extend(this,a);a={alt:this.alt,getTileUrl:jQuery.proxy(this.getTileUrl,this),isPng:!1,maxZoom:17,minZoom:6,
name:this.name,tileSize:new google.maps.Size(256,256)};this.imageMapType=new google.maps.ImageMapType(a)};e.CapaTMS.prototype.getTileUrl=function(a,c){var b=this.baseURL;if("string"!==typeof b){var b=l(a.x+""+a.y,b),f=this.cache.recuperar(a.x,a.y,c);if(f)return f}b=b+"/"+this.layers+"/"+c+"/"+a.x+"/"+((1<<c)-a.y-1)+".png";this.cache.guardar(a.x,a.y,c,b);return b};e.CapaBaseArgenmap=function(){e.CapaBaseTMS.apply(this,[{name:"Mapa IGN",baseURL:m,layers:"capabaseargenmap"}])};e.CapaBaseArgenmap.prototype.getTileUrl=
function(){return e.CapaBaseTMS.prototype.getTileUrl.apply(this,arguments)};e.CapaTMSArgenmap=function(){e.CapaTMS.apply(this,[{name:"IGN",baseURL:m,layers:"capabasesigign"}])};e.CapaTMSArgenmap.prototype.getTileUrl=function(a,c){return"satellite"!==this.gmap.getMapTypeId()?!1:e.CapaTMS.prototype.getTileUrl.apply(this,arguments)};e.GmapAgregarCapaBase=function(a,c){var b;c.gmap=a;a.mapTypes.set(c.imageMapType.name,c.imageMapType);a.mapTypeControlOptions?(b=a.mapTypeControlOptions.mapTypeIds)?b.splice(0,
0,c.imageMapType.name):b=[c.imageMapType.name,"satellite"]:b=[c.imageMapType.name,"satellite"];a.setOptions({mapTypeControlOptions:{mapTypeIds:b,style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}})};e.GmapAgregarCapa=function(a,c){c.gmap=a;a.overlayMapTypes.push(c.imageMapType)};e._prepararContenedor=function(a){var d=e.BASEURL+"img/logoignsintexto-25px.png",b=c('<div class="argenmapMapCanvas" />').css({width:"100%","min-height":"200px"}),f=c('<div class="argenmapMapFooter" />').css({"font-family":"Arial",
"background-color":"#1C74A5","box-shadow":"0 0 11px rgb(5, 66, 100) inset","font-size":"10px","text-align":"right",height:"30px","vertical-align":"middle",color:"white","min-height":"25px","line-height":"13px",padding:"5px",margin:0,border:0}),g=c("<img />"),h=c('<a style="float:left" target="_blank" href="http://www.ign.gob.ar/argenmap/argenmap.jquery/docs"></a>').append(g);g.attr("src",d).css({border:"0"});a.append(b);a.append(f);f.append(h);f.append('<a style="color:white;text-decoration:underline;font-weight:normal" target="_blank" href="http://www.ign.gob.ar/argenmap/argenmap.jquery/docs/#datosvectoriales">Top&oacute;nimos, datos topogr&aacute;ficos - 2013 IGN Argentina // Calles - OpenStreetMap</a>');
e._maximizarCanvas(a,f,b);return b.get(0)};e._maximizarCanvas=function(a,c,b){var f=a.innerHeight()-c.outerHeight();b.height(f);a.bind("resized",function(f){f=a.innerHeight()-c.outerHeight();b.height(f);google.maps.event.trigger(a.data().gmap,"resize")})};e.latLngAMercator=function(a,c){var b=2.003750834E7*c/180,f=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return{lat:2.003750834E7*f/180,lng:b}};c.event.special.resized={interval:0,setup:function(){var a=this,d=c(this),b=d.width(),f=d.height();
c.event.special.resized.interval=setInterval(function(){if(b!==d.width()||f!==d.height())b=d.width(),f=d.height(),jQuery.event.handle.call(a,{type:"resized"})},100)},teardown:function(){clearInterval(c.event.special.resized.interval)}};c.fn.argenmap=function(a){var d=[];c.each(this,function(){var b=c(this).data("argenmap");b||(b=new p(this,a),c(this).data("argenmap",b),b.init())});return d.length?1===d.length?d[0]:d:this};c.fn.agregarCapaBaseWMS=function(a){return this.each(function(){if(c(this).data("argenmap")){var d=
c(this).data("gmap");e.GmapAgregarCapaBase(d,new e.CapaBaseWMS({name:a.nombre,baseURL:a.url,layers:a.capas}))}})};c.fn.agregarCapaBaseTMS=function(a){return this.each(function(){if(c(this).data("argenmap")){var d=c(this).data("gmap");e.GmapAgregarCapaBase(d,new e.CapaBaseTMS({name:a.nombre,baseURL:a.url,layers:a.capas}))}})};c.fn.agregarCapaWMS=function(a){return this.each(function(){if(c(this).data("argenmap")){var d=c(this).data("gmap");e.GmapAgregarCapa(d,new e.CapaWMS({name:a.nombre,baseURL:a.url,
layers:a.capas}))}})};c.fn.agregarCapaTMS=function(a){return this.each(function(){if(c(this).data("argenmap")){var d=c(this).data("gmap");e.GmapAgregarCapaTMS(d,new e.CapaTMS({name:a.nombre,baseURL:a.url,layers:a.capas}))}})};c.fn.agregarCapaKML=function(a){return this.each(function(){var d=c(this).data("argenmap");d&&d.agregarCapaKML(a)})};c.fn.centro=function(a,d){if(0===arguments.length){if(!this.data("argenmap"))return[];var b=this.data("gmap").getCenter();return b?[b.lat(),b.lng()]:[]}return this.each(function(){c(this).data("argenmap")&&
c(this).data("gmap").setCenter(new google.maps.LatLng(a,d))})};c.fn.zoom=function(a){if(void 0===a){if(!this.data("argenmap"))return null;var d=this.data("gmap").getZoom();return d?d:null}return this.each(function(){c(this).data("argenmap")&&c.isNumeric(a)&&c(this).data("gmap").setZoom(a)})};c.fn.capaBase=function(a){if(void 0===a){if(!this.data("argenmap"))return null;var d=this.data("gmap").mapTypeId;return d?d:null}return this.each(function(){c(this).data("argenmap")&&c(this).data("gmap").setMapTypeId(a)})};
c.fn.agregarMarcador=function(a,d){var b=arguments;return this.each(function(){var d=c.extend({},a),e=c(this).data("argenmap");e&&(0===b.length?(d.lat=c(this).data("gmap").getCenter().lat(),d.lng=c(this).data("gmap").getCenter().lng()):2===b.length&&(c.isNumeric(b[0])&&c.isNumeric(b[1]))&&(d.lat=b[0],d.lng=b[1]),d.hasOwnProperty("long")?d.lng=d["long"]:d.hasOwnProperty("lon")?d.lng=d.lon:d.hasOwnProperty("lat")&&"function"===typeof d.lat&&(d.lat=d.lat(),d.lng=d.lng()),e.agregarMarcador(d))})};c.fn.agregarMarcadores=
function(a){return this.each(function(){c(this).data("argenmap")&&c.each(a,function(a,b){c(this).agregarMarcador(b)})})};c.fn.limpiarMapa=function(a){return this.each(function(){c(this).data("argenmap")&&c(this).argenmap({accion:"limpiar"})})};c.fn.quitarMarcador=function(a){return this.each(function(d,b){if("string"===typeof a){var e=c(this).data("argenmap");e&&e.quitarMarcador(a)}})};c.fn.modificarMarcador=function(a,d){return this.each(function(b,e){if("string"===typeof a&&void 0!==d&&"object"===
typeof d){var g=c(this).data("argenmap");g&&g.modificarMarcador(a,d)}})}})(jQuery);
